<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customizing dccvalidator • dccvalidator</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Customizing dccvalidator">
<meta property="og:description" content="dccvalidator">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dccvalidator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0.9025</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/customizing-dccvalidator.html">Customizing dccvalidator</a>
    </li>
    <li>
      <a href="../articles/deploying-dccvalidator.html">Deploying dccvalidator</a>
    </li>
    <li>
      <a href="../articles/study-documentation-amp-ad.html">AMP-AD Study Documentation</a>
    </li>
    <li>
      <a href="../articles/study-documentation-pec.html">PEC Study Documentation</a>
    </li>
    <li>
      <a href="../articles/using-the-dccvalidator-app-amp-ad.html">Using the dccvalidator app in AMP-AD</a>
    </li>
    <li>
      <a href="../articles/using-the-dccvalidator-pec.html">Using the dccvalidator app in PsychENCODE</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Sage-Bionetworks/dccvalidator/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="customizing-dccvalidator_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Customizing dccvalidator</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/vignettes/customizing-dccvalidator.Rmd"><code>vignettes/customizing-dccvalidator.Rmd</code></a></small>
      <div class="hidden name"><code>customizing-dccvalidator.Rmd</code></div>

    </div>

    
    
<p>dccvalidator is intended customizable for different settings, however the built-in Shiny application is designed to ensure that data conforms to a specific project organization structure in which data is organized into studies that are described with a combination of metadata files. These metadata files document the individuals, specimens, and assay(s) that were performed in the study. Documenting the data in this way allows researchers to describe the study at different levels while minimizing repetition. These metadata files can later be joined on the <code>individualID</code> and <code>specimenID</code> columns to create a table of all of the metadata for the study.</p>
<p>For projects like AMP-AD, PsychENCODE, and others that follow the same structure, see the next section (“Customizing the Shiny application”) for how to configure an instance of the application for the project.</p>
<p>For projects that do not follow the same structure but wish to use some elements of dccvalidator’s data validation capabilities, see “Extending dccvalidator” below.</p>
<div id="customizing-the-shiny-application" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-the-shiny-application" class="anchor"></a>Customizing the Shiny application</h2>
<p>The Shiny app uses a <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/config.yml">configuration file</a> to set details such as where to store uploaded files, which metadata templates to validate against, whom to contact with questions, etc.</p>
<p>To create a custom version of the app, you’ll need to follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Create a Synapse project or folder with the appropriate permissions to store uploaded files. In AMP-AD, we created a folder to which consortium members have permissions to read and write, but <em>not</em> download. Only the curation team has the ability to download files (in order to assist with debugging). See this <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/inst/app/create_project.R">example of how to create a project with appropriate permissions</a>.</li>
<li>Fork the <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/config.yml">dccvalidator</a> GitHub repository.</li>
<li>(For a production version): register a Synapse OAuth client (see <a href="https://help.synapse.org/docs/Using-Synapse-as-an-OAuth-Server.2048327904.html#UsingSynapseasanOAuthServer-RegisteringandLinkinganOAuth2.0Client">Synapse Docs</a>) and store the <code>client_name</code>, <code>client_id</code> and <code>client_secret</code> in a .Renviron file within the repository. Ensure you are the only person who has access to this file (e.g. <code>chmod 600 .Renviron</code> or <code>chmod 400 .Renviron</code>).</li>
<li>(For running locally only): create a .synapseConfig file in your home directory with your Synapse authentication credentials (see the <a href="https://r-docs.synapse.org/articles/manageSynapseCredentials.html#use-synapseconfig">synapser docs for an example</a>).</li>
<li>Create a new configuration in the <code>config.yml</code> file. Note that any values you do not customize will be inherited from the default configuration. The configuration file must have a <code>default</code> configuration.</li>
<li>(Optional): create a pull request with your configuration back to the upstream dccvalidator repository.</li>
<li>Within the file <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/app.R"><code>app.R</code></a>, replace the <code>"default"</code> configuration with the name of your new configuration.</li>
<li>Deploy the application as described in the <a href="https://sage-bionetworks.github.io/dccvalidator/articles/deploying-dccvalidator.html">Deploying dccvalidator</a> vignette.</li>
</ol>
<p>To install the dccvalidator instead of forking the repository:</p>
<ol style="list-style-type: decimal">
<li>
<p>Create an <code>app.R</code> file containing the following:</p>
<pre><code><a href="https://sage-bionetworks.github.io/dccvalidator">library("dccvalidator")
run_app()</a></code></pre>
</li>
<li>
<p>Create a <code>config.yml</code> file using the configuration options specified below and name the parameters “default”.</p>
<pre><code>default:
parent: "syn20400157"</code></pre>
</li>
<li><p>Create a Synapse project or folder with the appropriate permissions to store uploaded files. In AMP-AD, we created a folder to which consortium members have permissions to read and write, but <em>not</em> download. Only the curation team has the ability to download files (in order to assist with debugging). See this <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/inst/app/create_project.R">example of how to create a project with appropriate permissions</a>.</p></li>
<li><p>Create a .synapseConfig file in your home directory with your Synapse authentication credentials (see the <a href="https://r-docs.synapse.org/articles/manageSynapseCredentials.html#use-synapseconfig">synapser docs for an example</a>).</p></li>
</ol>
<div id="configuration-options" class="section level3">
<h3 class="hasAnchor">
<a href="#configuration-options" class="anchor"></a>Configuration options</h3>
<ul>
<li>
<code>production</code>: <code>TRUE</code> to use production Synapse endpoints; <code>FALSE</code> to use staging endpoints. Used for testing new versions of the client before they are officially released. For information on endpoints, see <a href="https://python-docs.synapse.org/build/html/index.html?highlight=endpoints#synapseclient.Synapse.setEndpoints">Synapse client documentation</a>.</li>
<li>
<code>app_url</code>: The URL for the app when in production. This is required for using the Synapse OAuth 2.0 client for logging into the application. See <a href="https://sage-bionetworks.github.io/dccvalidator/articles/deploying-dccvalidator.html">Deploying dccvalidator</a> for more information.</li>
<li>
<code>parent</code>: The Synapse project or folder where files will be stored</li>
<li>
<code>path_to_markdown</code>: Location of an R Markdown document with app instructions. If you wish to omit instructions, insert <code>!expr NA</code>.</li>
<li>
<code>study_table</code>: Synapse ID of a table that lists all of the existing studies in the consortium. It should have a column called <code>StudyName</code>
</li>
<li>
<code>samples_table</code>: Synapse ID of a table that lists the key-value pairs of <code>study</code>, <code>individualID</code>, <code>specimenID</code>, <code>assay</code>, <code>species</code> to validate that additions to existing studies retain all IDs that were previously shared.</li>
<li>
<code>annotations_table</code>: Synapse ID of a table that lists allowable annotation keys and values for the consortium. This should follow the same basic format as our Synapse Annotations table, e.g. there must be the following columns: <code>key</code>, <code>value</code>, and <code>columnType</code>. <code>columnType</code> options are <code>STRING</code>, <code>BOOLEAN</code>, <code>INTEGER</code>, <code>DOUBLE</code>.</li>
<li>
<code>annotations_link</code>: URL to a list or description of allowable annotation values (so users can read more)</li>
<li>
<code>templates_link</code>: URL to the location of metadata templates</li>
<li>
<code>docs_tab</code>: These settings configure the documentation tab, including the option to not have a tab at all.
<ul>
<li>
<code>include_tab</code>: <code>TRUE</code> to include the documentation tab in the app, else <code>FALSE</code>.</li>
<li>
<code>include_upload_widget</code>: <code>TRUE</code> to include the widget that allows upload of documentation, else <code>FALSE</code>. <code>include_tab</code> must be <code>TRUE</code> to have the widget.</li>
<li>
<code>tab_name</code>: Desired name of the documentation tab.</li>
<li>
<code>path_to_docs_markdown</code>: Location of an R Markdown document with documentation instructions.</li>
</ul>
</li>
<li>
<code>teams</code>: The team(s) a user must be a member of in order to use the app. If the user is not in any of the teams, they will see a message telling them they must be added to one of the teams.</li>
<li>
<code>include_biospecimen_type</code>: <code>TRUE</code> to include specific biospecimen types within each species, else <code>FALSE</code>. This will dictate whether the Specimen Type panel appears in the validator tab.</li>
<li>
<code>templates</code> (including <code>manifest_template</code>, <code>individual_templates</code>, <code>biospecimen_templates</code>, and <code>assay_templates</code>): Location of templates to use for validation. These may be a Synapse synID or the id of a Synapse-registered JSON schema. See the <a href="https://github.com/Sage-Bionetworks/dccvalidator/blob/master/inst/config.yml">config file here</a> for an example and see below for more detailed information on <code>templates</code>.
<ul>
<li>Template reference types:
<ul>
<li>synID: Templates accessed via synID should be either .xlsx or .csv files, where the column names reflect the needed columns in the template. If the template is an excel file with multiple sheets, the first sheet will be used.</li>
<li>JSON schema id: Templates accessed via JSON schema id should be registered in Synapse. The schema should have a <code>properties</code> object listing all column names (a.k.a. keys) that should be present in the metadata. The <code>manifest_template</code> should have only one template.</li>
</ul>
</li>
<li>Template types:
<ul>
<li>
<code>individual_templates</code>: Individual templates should be based on species. Note that the species must also be included in <code>species_list</code>.</li>
<li>
<code>biospecimen_templates</code>: Biospecimen templates have two options. The first option is for the biospecimen templates to be based on species only and <code>include_biospecimen_type</code> is set to <code>FALSE</code>. Note that the species must also be included in <code>species_list</code>. The second option is for the biospecimen templates to be be based on both a species and a biospecimen type (e.g. in vitro, in vivo) and <code>include_biospecimen_type</code> is set to <code>TRUE</code>. If the biospecimen templates have specific biospecimen types, these will be reflected in the validation section for the users to select the correct type.</li>
<li>
<code>assay_templates</code>: Assay templates should be based on assay type. The list assays will be reflected in the validation section for users to select the correct type.</li>
</ul>
</li>
</ul>
</li>
<li>
<code>species_list</code>: List of possible species in the consortium. These are shown as options in the validation UI and control which individual template and biospecimen template the app validates against.</li>
<li>
<code>complete_columns</code>: For each metadata file and the manifest, a list of the columns that must be complete (i.e. not contain any missing values or empty strings). For metadata files, this should typically include <code>"individualID"</code> and/or <code>"specimenID"</code>.</li>
<li>
<code>contact_email</code>: Email address linked in footer for users to contact if they have questions</li>
</ul>
</div>
</div>
<div id="extending-dccvalidator" class="section level2">
<h2 class="hasAnchor">
<a href="#extending-dccvalidator" class="anchor"></a>Extending dccvalidator</h2>
<p>Users who wish to use dccvalidator for projects that do not follow the same structure as AMP-AD and PsychENCODE can do so by reusing the existing validation functions in their own R code, implementing new checks as needed, and reusing Shiny modules from dccvalidator.</p>
<div id="using-validation-functions-in-scripts" class="section level3">
<h3 class="hasAnchor">
<a href="#using-validation-functions-in-scripts" class="anchor"></a>Using validation functions in scripts</h3>
<p>Functions to check data for common quality issues are at the core of dccvalidator. These functions in dccvalidator are all named with the pattern <code>check_*()</code>: <code><a href="../reference/check_annotation_keys.html">check_annotation_keys()</a></code>, <code><a href="../reference/check_annotation_values.html">check_annotation_values()</a></code>, <code><a href="../reference/check_cols_empty.html">check_cols_empty()</a></code>, etc. See the <a href="https://sage-bionetworks.github.io/dccvalidator/reference/index.html#section-data-validation-functions">function reference</a> for a complete list.</p>
<p>These functions are used in the dccvalidator Shiny app, but they can also be used in scripts or reports. Each function takes data as input and returns results in the form of custom condition objects. The condition objects inherit from R’s <code>"message"</code>, <code>"warning"</code>, and <code>"error"</code> classes. However, rather than raising a message/warning/error, the check functions in dccvalidator return the condition objects themselves.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://sage-bionetworks.github.io/dccvalidator">"dccvalidator"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://readr.tidyverse.org">"readr"</a></span><span class="op">)</span>

<span class="co">## Load a sample manifest</span>
<span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_manifest.txt"</span>, package <span class="op">=</span> <span class="st">"dccvalidator"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">manifest</span>
<span class="co">#&gt; # A tibble: 3 × 12</span>
<span class="co">#&gt;   path      parent  specimenID individualID assay fakeAnnotation tissue organ   </span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;        &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;   </span>
<span class="co">#&gt; 1 /foo/bar  syn204… a1         P01          rnaS…              1 kleen… wrong o…</span>
<span class="co">#&gt; 2 /foo/baz  syn204… a2         P02          rnaS…              2 puffs  another…</span>
<span class="co">#&gt; 3 test_ind… syn204… &lt;NA&gt;       &lt;NA&gt;         &lt;NA&gt;              NA &lt;NA&gt;   &lt;NA&gt;    </span>
<span class="co">#&gt; # … with 4 more variables: metadataType &lt;chr&gt;, isMultiSpecimen &lt;lgl&gt;,</span>
<span class="co">#&gt; #   grant &lt;lgl&gt;, consortium &lt;lgl&gt;</span>

<span class="co">## Check that required columns are complete in the manifest</span>
<span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_cols_complete.html">check_cols_complete</a></span><span class="op">(</span>
  <span class="va">manifest</span>,
  required_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"path"</span>, <span class="st">"parent"</span>, <span class="st">"grant"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">result</span>
<span class="co">#&gt; &lt;error/check_fail&gt;</span>
<span class="co">#&gt; There is missing data in some columns that are required to be complete</span></code></pre></div>
<p>The condition objects contain several useful pieces of information. There is a message describing the result of the check, as well as a message describing the expected outcome. For warnings and errors, the data that caused the warning or error is included.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">result</span><span class="op">$</span><span class="va">message</span>
<span class="co">#&gt; [1] "There is missing data in some columns that are required to be complete"</span>
<span class="va">result</span><span class="op">$</span><span class="va">behavior</span>
<span class="co">#&gt; [1] "There should be no missing values in columns path, parent, grant"</span>
<span class="va">result</span><span class="op">$</span><span class="va">data</span>
<span class="co">#&gt; [1] "grant"</span></code></pre></div>
</div>
<div id="creating-new-validation-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#creating-new-validation-functions" class="anchor"></a>Creating new validation functions</h3>
<p>While we have functions for many data validation tasks, users may wish to create their own custom checking functions. The functions <code><a href="../reference/check_pass.html">check_pass()</a></code>, <code><a href="../reference/check_pass.html">check_warn()</a></code>, and <code><a href="../reference/check_pass.html">check_fail()</a></code> will create condition objects from the provided arguments. Here is an example of how one could write a custom function that checks if pH values are within an appropriate range.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>pH <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">6</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span>

<span class="va">check_values_ph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">ph_col</span> <span class="op">=</span> <span class="st">"pH"</span>,
                            <span class="va">success_msg</span> <span class="op">=</span> <span class="st">"All pH values are valid"</span>,
                            <span class="va">fail_msg</span> <span class="op">=</span> <span class="st">"Some pH values are outside the range 0-14"</span>,
                            <span class="va">behavior_msg</span> <span class="op">=</span> <span class="st">"pH values should be between 0-14"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">values</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">ph_col</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">values</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">values</span> <span class="op">&lt;=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/check_pass.html">check_pass</a></span><span class="op">(</span>
      msg <span class="op">=</span> <span class="va">success_msg</span>,
      behavior <span class="op">=</span> <span class="va">behavior_msg</span>
    <span class="op">)</span>
  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="../reference/check_pass.html">check_fail</a></span><span class="op">(</span>
      msg <span class="op">=</span> <span class="va">fail_msg</span>,
      behavior <span class="op">=</span> <span class="va">behavior_msg</span>,
      data <span class="op">=</span> <span class="va">values</span><span class="op">[</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">|</span> <span class="va">values</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span>
    <span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>

<span class="fu">check_values_ph</span><span class="op">(</span><span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt; &lt;error/check_fail&gt;</span>
<span class="co">#&gt; Some pH values are outside the range 0-14</span></code></pre></div>
<p>The <code><a href="../reference/check_condition.html">check_condition()</a></code> function can make the above a little more concise:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">check_values_ph</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">ph_col</span> <span class="op">=</span> <span class="st">"pH"</span>,
                            <span class="va">success_msg</span> <span class="op">=</span> <span class="st">"All pH values are valid"</span>,
                            <span class="va">fail_msg</span> <span class="op">=</span> <span class="st">"Some pH values are outside the range 0-14"</span>,
                            <span class="va">behavior_msg</span> <span class="op">=</span> <span class="st">"pH values should be between 0-14"</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>, <span class="va">ph_col</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span><span class="op">)</span>
  <span class="va">all_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">values</span> <span class="op">&gt;=</span> <span class="fl">0</span> <span class="op">&amp;</span> <span class="va">values</span> <span class="op">&lt;=</span> <span class="fl">14</span><span class="op">)</span>
  
  <span class="fu"><a href="../reference/check_condition.html">check_condition</a></span><span class="op">(</span>
    msg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">all_valid</span>, <span class="va">success_msg</span>, <span class="va">fail_msg</span><span class="op">)</span>,
    behavior <span class="op">=</span> <span class="va">behavior_msg</span>,
    data <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">all_valid</span><span class="op">)</span> <span class="va">values</span><span class="op">[</span><span class="va">values</span> <span class="op">&gt;</span> <span class="fl">14</span> <span class="op">|</span> <span class="va">values</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span>,
    type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">all_valid</span>, <span class="st">"check_pass"</span>, <span class="st">"check_fail"</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="reusing-app-modules" class="section level3">
<h3 class="hasAnchor">
<a href="#reusing-app-modules" class="anchor"></a>Reusing app modules</h3>
<p>The Shiny app that dccvalidator provides allows users to see the results of data validation. This module (<code><a href="../reference/results_boxes_ui.html">results_boxes_server()</a></code>/<code><a href="../reference/results_boxes_ui.html">results_boxes_ui()</a></code>) is exported from dccvalidator and can be reused in other Shiny applications like so:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://shiny.rstudio.com/">"shiny"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="http://rstudio.github.io/shinydashboard/">"shinydashboard"</a></span><span class="op">)</span>

<span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Load sample data</span>
  <span class="va">manifest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_tsv</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_manifest.txt"</span>, package <span class="op">=</span> <span class="st">"dccvalidator"</span><span class="op">)</span>
  <span class="op">)</span>
  <span class="va">biosp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"test_biospecimen.csv"</span>, package <span class="op">=</span> <span class="st">"dccvalidator"</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="co"># Add logic to run the checks you are interested in and store the results in a</span>
  <span class="co"># list. Here is an example:</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/check_cols_complete.html">check_cols_complete</a></span><span class="op">(</span>
      <span class="va">manifest</span>,
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"path"</span>, <span class="st">"parent"</span>, <span class="st">"grant"</span><span class="op">)</span>,
      success_msg <span class="op">=</span> <span class="st">"All required columns present are complete in the manifest"</span>,
      fail_msg <span class="op">=</span> <span class="st">"Some required columns are incomplete in the manifest"</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/check_cols_complete.html">check_cols_complete</a></span><span class="op">(</span>
      <span class="va">biosp</span>,
      <span class="st">"specimenID"</span>,
      success_msg <span class="op">=</span> <span class="st">"All required columns present are complete in the biospecimen metadata"</span>,
      fail_msg <span class="op">=</span> <span class="st">"Some required columns are incomplete in the biospecimen metadata"</span>
    <span class="op">)</span>,
    <span class="fu"><a href="../reference/check_indiv_ids_dup.html">check_specimen_ids_dup</a></span><span class="op">(</span>
      <span class="va">biosp</span>,
      success_msg <span class="op">=</span> <span class="st">"Specimen IDs in the biospecimen metadata file are unique"</span>,
      fail_msg <span class="op">=</span> <span class="st">"Duplicate specimen IDs found in the biospecimen metadata file"</span>
    <span class="op">)</span>
  <span class="op">)</span>
  
  <span class="co"># Show results in boxes</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/callModule.html">callModule</a></span><span class="op">(</span><span class="va">results_boxes_server</span>, <span class="st">"validation_results"</span>, <span class="va">res</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">ui</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">request</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardPage.html">dashboardPage</a></span><span class="op">(</span>
    header <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardHeader.html">dashboardHeader</a></span><span class="op">(</span><span class="op">)</span>,
    sidebar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardSidebar.html">dashboardSidebar</a></span><span class="op">(</span><span class="op">)</span>,
    body <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/dashboardBody.html">dashboardBody</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/pkg/htmltools/man/include.html">includeCSS</a></span><span class="op">(</span>
        <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"app/www/custom.css"</span>, package <span class="op">=</span> <span class="st">"dccvalidator"</span><span class="op">)</span>
      <span class="op">)</span>,
      <span class="fu"><a href="../reference/results_boxes_ui.html">results_boxes_ui</a></span><span class="op">(</span><span class="st">"validation_results"</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kara Woo, Nicole Kauer, Kelsey Montgomery.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
